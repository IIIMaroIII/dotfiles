#!/usr/local/bin/bash


read -r -p "   ğŸ”— Enter the entry point we'll search in: " root;
read -r -p "   ğŸ”§ Enter a symbol/s which you wanna find in directories (simply type chars without any spaces or new line characters): " symbols
read -r -p "   ğŸ’¡ Enter the character you want to replace: " replace_to
read -r -p "   ğŸ“‚ Is that directory or a ğŸ“ file? (enter d/f): " typeof

[[ ! -e "$root" ]] && {
    echo "  âŒ The $root doesn't exist"
    exit 1
}

[[ "$typeof" != "d" && "$typeof" != "f" ]] && {
    echo "  ğŸ‘‰ Use a character <d> for <directories>, and <f> for <file/s>. "
    echo "  â™¿ï¸ Exiting..."
    exit 1
}


if [[ "$typeof" == "d" ]]; then { while IFS= read -r foundpath; do
     echo "     âš ï¸ Found $foundpath:" # W: paths is referenced but not assigned (did you mean 'patâ€¦

         parentdir=$(dirname "$foundpath")
        dirname_only=$(basename "$foundpath")
        newname="${dirname_only//$symbols/$replace_to}"
        newpath="$parentdir/$newname"

        [[ "$foundpath" == "$newpath" ]] && continue  # nothing to do
        [[ -e "$newpath" ]] && {
            echo "  âŒ $newpath already exists, skipping"
            continue
        }

        echo "  ğŸ”ˆ Renaming $foundpath -> $newpath"
        mv "$foundpath" "$newpath"


done < <(find "$root" -depth -type d\
     -iname "*[$symbols]*" \
            ! -path "./.git/*" \
            ! -path "*/.git/*" \
            ! -path "./.vim/*" \
            ! -path "*/.vim/*" \
            ! -path "./.idea/*" \
            ! -path "*/.idea/*" \
            ! -path "./.DS_Store/*" \
            ! -path "*/.DS_Store/*"
    )
}
else {
     # Files
    while IFS= read -r foundpath; do
        parentdir=$(dirname "$foundpath")
        filename=$(basename "$foundpath")
        newname="${filename//$symbols/$replace_to}"
        newpath="$parentdir/$newname"

        [[ "$foundpath" == "$newpath" ]] && continue
        [[ -e "$newpath" ]] && { echo "âŒ '$newpath' already exists, skipping"; continue; }

        echo "ğŸ”ˆ Renaming '$foundpath' -> '$newpath'"
        mv "$foundpath" "$newpath"
    done < <(find "$root" -type f -iname "*[$symbols]*" \
            ! -path "./.git/*" \
            ! -path "*/.git/*" \
            ! -path "./.vim/*" \
            ! -path "*/.vim/*" \
            ! -path "./.idea/*" \
            ! -path "*/.idea/*" \
            ! -path "./.DS_Store/*" \
            ! -path "*/.DS_Store/*"
        
)
}
fi
