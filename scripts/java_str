#!/usr/local/bin/bash


read -p "        âš™ï¸  Which folder/s do you wanna create in the current folder: " -a folders


for f in "${folders[@]}"; do
    [[ "$f" == ".git" ]] && continue
    
    fpath="src/main/lt/esdc/${f^}"

    if [[ -d "$fpath" ]]; then
        echo "  âš ï¸  Skipped: Folder already exists â†’ $fpath"
        continue
    fi

    mkdir -p "$fpath"
    echo "  ğŸ€ Note: Created a folder $fpath "
    
done

# Create a Main.java

touch "src/main/lt/esdc/Main.java"

read -p "        ğŸ›  Do you wanna create '.java' file in the last folder/s?  [y/n]" confirm; 

[[ $confirm != [Yy] ]] && {
    echo "  âŒ Operation cancelled"
    exit 1
}

read -p "        ğŸ“ Enter the root directory to start looping: [src or out, without '/' or '.']" root;

[[ ! -d "$root" ]] && {
    echo "  âŒ The $root folder does not exist"
    exit 1
}

while IFS= read -r dir; do
    # Skip .git directories
    [[ "$dir" == *"/.git"* ]] && continue

    # Skip non-leaf folders (folders that contain subfolders)
    subdirs=$(find "$dir" -mindepth 1 -maxdepth 1 -type d)
    [[ -n "$subdirs" ]] && continue

    folder_name=$(basename "$dir")
    java_file="$dir/${folder_name^}.java"

    # ğŸš¨ Exit if any .java file already exists
    if [[ -f "$java_file" ]]; then
        echo "  âŒ ERROR: Java file already exists â†’ $java_file"
        echo "  ğŸ”’ Skipping this file."
        continue
    fi

    echo "  ğŸ€ Preparing to create: $java_file"
    touch "$java_file"
    echo "  âœ… Created Java file â†’ $java_file"

done < <(find "$root" -type d)

echo "  ğŸ‰ All Java files created successfully!"
